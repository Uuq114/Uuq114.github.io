---
title: gdb、常用寄存器
date: 2021-11-22 16:43:50
tags: 
- register
- gdb
categories:
- 操作系统
---





# 简介

最近在写CSAPP的bomb lab，需要用gdb调试，还涉及到一些汇编的代码。这里记录一下gdb调试的方法，以及常用寄存器的作用。

<!-- more -->

## gdb

| `r`                   | 运行程序                                                     |
| --------------------- | ------------------------------------------------------------ |
| `b *<地址>`           | 在某个地址设置断点，具体哪里，可以看反汇编的代码，可以根据那个直接复制粘贴设断点的 |
| `d`                   | 删除所有断点                                                 |
| `d <断点编号>`        | 删除指定断点                                                 |
| `info b`              | 查看所有断点                                                 |
| `continue`            | 从断点处继续执行                                             |
| `display $<寄存器名>` | 跟踪寄存器，碰到断点停下时会显示出所有跟踪的寄存器的当前值，非常好用的一个命令，注意的是gdb中表示寄存器的话前面用的不是百分符号%，而是美元符号$ |
| `x/<参数> <地址>`     | 访问地址的内存，其实就是间接访问，也是很好用的指令，关于参数，s是输出为字符串，d为输出为十进制，x为输出为十六进制，b、w、l、q控制输出字节，默认是w，四字节，s字符串不受这个控制除外。 |
| `info r`              | 查看所有寄存器                                               |

用gdb运行带参数的可执行文件：

```bash
gdb --args bomb defuse	// defuse是参数
```



## 常用寄存器

寄存器一般以`e`或`r`开头，`e`代表32位，`r`代表64位。



一般寄存器：AX、BX、CX、DX
AX：累积暂存器，BX:基底暂存器，CX:计数暂存器，DX:资料暂存器

> 前面有函数调用的话，一般`%rax`就是程序的返回值

索引暂存器：SI、DI
SI：来源索引暂存器，DI：目的索引暂存器

堆叠、基底暂存器：SP、BP
SP：堆叠指标暂存器，BP：基底指标暂存器



`ebp`称为基址指针（base pointer），在反编译的文件中，经常可以看到一个函数的起始代码：

```asm
push ebp 		;保存当前ebp
mov ebp,esp 	;EBP设为当前堆栈指针
sub esp, xxx 	;预留xxx字节给函数临时变量.
...

; bomb example
0000000000400efc <phase_2>:
  400efc:	55                   	push   %rbp
  400efd:	53                   	push   %rbx
  400efe:	48 83 ec 28          	sub    $0x28,%rsp
  400f02:	48 89 e6             	mov    %rsp,%rsi
  ; ...
  400f3c:	48 83 c4 28          	add    $0x28,%rsp
  400f40:	5b                   	pop    %rbx
  400f41:	5d                   	pop    %rbp
  400f42:	c3                   	retq   
```

这样一来，EBP 构成了该函数的一个框架，在EBP上方分别是原来的EBP，返回地址和参数。



`esp`专门用作堆栈指针，被形象地称为栈顶指针，堆栈的顶部是地址小的区域，压入堆栈的数据越多，`esp`也就越来越小。在32位平台上，`esp`每次减少4字节。